# 信号处理

!!! abstract "摘要"

    无论是采用侵入式还是非侵入式技术记录到的大脑信号，一般都会含有多种噪声或者来自多个神经元的混合信号，本章介绍了从原始信号中提取有用信号的常用方法。

    - 对于侵入式技术，锋电位分类将单个神经元产生的锋电位从混合信号中提取出来；
    - 对于非侵入式技术，有多种特征提取技术可用，这些基于频域、时域或小波分析的技术可与空间滤波技术相结合，以实现降维（PCA）、从混合信号中分离出源信号（ICA）或增加输出的不同类别信号的可区分度（CSP）；
    - 其中部分技术还能用于去除源于大脑外部的伪迹；

    总而言之，没有一种最佳技术普适于所有BCI应用，需要根据特定的BCI范式和任务类型来选择。

## 锋电位分类

用于BCI的侵入式技术通常依赖于由微电极阵列记录到的锋电位，这些信号通常是电极附近数个神经元所产生的神经混合信号。传统的BCI输入信号形式期望是来自单个神经元的锋电位，所以需要**通过锋电位分类将单个神经元产生的锋电位从混合信号中提取出来**。

锋电位分类具有以下几种常用方法：
- 依据幅值幅度的分类
- 窗型鉴别器（人工）
- 自动归类（最新的趋势），依据锋电位波形的特征（特征提取方法：小波分析、主成分分析等）

## 频域分析

诸如EEG的非侵入式技术基于能反映数千个神经元活动的信号，这些信号能捕捉[具有特定频率范围的“脑电波”](../Ch3/#_9)，因此对信号进行频域分析特别有用。

### 傅里叶分析

傅里叶分析的基本思想是将一个信号分解为不同频率的正弦和余弦波的加权和，幅值 $a_n$ 和 $b_n$ 能由输入信号计算得到。信号分解使我们可以进行基于频率的多种类型的滤波处理。

??? quote "时域信号 $s(t)$ 的傅里叶级数展开"

    $$
    s(t) = \frac{a_0}{2} + \sum_{n=1}^\infty a_0 cos(2\pi nft) + \sum_{n=1}^\infty b_0 sin(2\pi nft)
    $$

    $$
    a_n = \frac{2}{T} \int_{-T/2}^{T/2} {s(t) cos(2\pi nft) dt}
    $$

    $$
    b_n = \frac{2}{T} \int_{-T/2}^{T/2} {s(t) sin(2\pi nft) dt}
    $$

    $$
    \frac{a_0}{2} = \frac{1}{T} \int_{-T/2}^{T/2} {s(t) dt}
    $$

??? quote "复数形式的傅里叶变换及反变换"

    $$
    c_n = 
    \begin{cases}
    \frac{a_n - j b_n}{2} & n > 0 \\[2ex]
    \frac{a_0}{2} & n = 0 \\[2ex]
    \frac{a_n + j b_n}{2} & n < 0
    \end{cases}
    $$

    $$
    c_n = \frac{1}{T} \int_{-T/2}^{T/2} {s(t) e^{-jn\omega t} dt}
    $$

    $$
    s(t) = \sum_{n = -\infty}^{+\infty} c_n e^{-jn\omega t}
    $$

#### 离散傅里叶变换

BCI应用中，通常是在离散时间间隔对大脑信号进行采样，相应的可以使用离散傅里叶变换（DFT）。

许多BCI系统从一段时间间隔内大脑信号的功率谱中提取特征，计算信号的功率谱 $P(n)$ 即计算信号幅值的平方。

??? quote "离散傅里叶变换及功率谱"

    $$
    C(n) = \frac{1}{T} \sum_{t=0}^{T-1} S(t) e^{-jn\omega t} \quad n = 0,\cdots,T-1
    $$

    $$
    P(n) = Re(C(n)^2) + Im(C(n)^2)
    $$

#### 快速傅里叶变换

DFT的时间复杂度为 $O(T^2)$ ，当数据量较大时运算速度很不理想。快速傅里叶变换（FFT）是计算DFT的一种更高效的方法，时间复杂度为 $O(T\log T)$ 。

最通用的FFT算法是`Cooley-Tukey FFT算法`，采用了“分而治之”的策略，用递归的方法将一个DFT分成许多更小型的DFT。

**FFT是将时变信号变换到频域的最常用方法**。

### 小波分析

自然界的信号几乎都是非平稳的，但是傅里叶变换处理非平稳信号时效果较差，它只能获取信号总体上包含哪些频率的成分，但是对各成分出现的时刻并无所知。

??? example "时频相差很大的两个信号，可能拥有一样的傅里叶频谱图"

    ![傅里叶变换在平稳及非平稳条件下的表现](https://raw.githubusercontent.com/MinJoker/ImageHost/main/books/BCIAI/2.jpg "傅里叶变换在平稳及非平稳条件下的表现")

一种简单可行的优化方法是加窗，在短时窗内（近似平稳）进行傅里叶分析，这就是短时傅里叶分析（STFT）。但是STFT在选择窗口宽度时很难协调时间分辨率和频率分辨率之间的矛盾。

小波变换（WT）可以更好地解决这一问题。

小波变换的基函数不再是正弦和余弦函数，而是**有限长的会衰减的小波基**。小波函数由一个母小波通过伸缩和平移得到。尺度 $\alpha$ 控制小波函数的伸缩，平移量 $\tau$ 控制小波函数的平移，尺度对应频率，平移量对应时间。

$$
WT(\alpha, \tau) = \frac{1}{\sqrt[]{\alpha}} \int_{-\infty}^{+\infty} {f(t) \times \psi(\frac{t-\tau}{\alpha}) dt}
$$

小波分析信号处理不仅可以知道信号由怎样频率的成分，而且知道其在时域上对应的具体位置。傅里叶变换只能得到一个频谱，而小波变换可以得到一个时频谱。

![小波变换能同时确定时间和频率](https://raw.githubusercontent.com/MinJoker/ImageHost/main/books/BCIAI/3.png "小波变换能同时确定时间和频率")

此外，小波变换在处理突变信号时也优于傅里叶变换，因为傅里叶变换存在吉布斯效应，对突变信号的拟合效果不够理想。

!!! info ""

    但是，小波分析的难点在于寻找母小波（尺度函数），这是构造小波变换的关键所在。

## 时域分析



## 空间滤波

## 伪迹去除技术